<?php
    include "db_config.php";
        class User
        {
            public $db;
            protected array $errors = [];
            public function __construct()
            {
                //$this->db=new mysqli(DB_SERVER,DB_USERNAME,DB_PASSWORD,'hotel', DB_PORT);
                try {
                $this->db = new PDO("mysql:host=localhost;port=3307;dbname=storedb", DB_USERNAME, DB_PASSWORD);
                
                //if(mysqli_connect_errno())
            } catch (PDOException $e) {
                $this->errors[] = $e->getMessage();
                $this->errors[] = "Data can't be retrieved";
                // print "An Exception occurred. Message: " . $e->getMessage();
                //print "The system is busy please again try later";
                // $date = date('m.d.y h:i:s');                
                // $eMessage = $date . " | Exception Error | " , $errormessage . |\n";
                // error_log($eMessage,3,ERROR_LOG);
                // e-mail support person to alert there is a problem
                // error_log("Date/Time: $date - Exception Error, Check error log for
                //details", 1, noone@helpme.com, "Subject: Exception Error \nFrom:
                // Error Log <errorlog@helpme.com>" . "\r\n");

            } catch (PDOError $e) {
                $this->errors[] = $e->getMessage();
                $this->errors[] = "Data cannot be retrieved";
                // print "An Error occurred. Message: " . $e->getMessage();
                // print "The system is busy please try later";
                // $date = date('m.d.y h:i:s');        
                // $eMessage = $date . " | Error | " , $errormessage . |\n";
                // error_log($eMessage,3,ERROR_LOG);
                // e-mail support person to alert there is a problem
                // error_log("Date/Time: $date - Error, Check error log for
                //details", 1, noone@helpme.com, "Subject: Error \nFrom: Error Log
                // <errorlog@helpme.com>" . "\r\n");

           }
                //{
                   // echo "Error: Could not connect to database.";
                    //exit;
                //}
            }



            public function getErrors() {
                return $this->errors;
            }



        public function validateFirstname($firstname, $fieldname) {
            $first_name = trim($this->safe($_POST[$fieldname]));           
            if ((!empty($first_name)) && (preg_match('/[a-z\s]/i',$first_name)) && (strlen($first_name) <= 40)) {               
                //Sanitize the trimmed first name
                filter_var( $_POST[$fieldname], FILTER_SANITIZE_STRING);
                (filter_var($first_name, FILTER_SANITIZE_STRIPPED));
                       
            } else {    
                $this->errors[] = 'First Name missing or not alphabetic and space characters. Max 30';
            }

        }

           






        protected function safe($text) {
                $text = trim($text);               
                $bad_chars = array( "{", "}", "(", ")", ";", ":", "<", ">", "/", "$" );
                $text = str_ireplace($bad_chars, "", $text);        
                return htmlspecialchars($text, ENT_COMPAT|ENT_HTML5, 'UTF-8', false);
                }


            }